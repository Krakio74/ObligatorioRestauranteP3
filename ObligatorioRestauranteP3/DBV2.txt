create database ObligatorioPG3;

create table Usuario (
    ID int identity(1,1) primary key,
    Nombre varchar(50) not null,
    Apellido varchar(50) not null,
    Email varchar(100) not null,
    Telefono int not null,
    Contraseña varchar(100) not null,
    Activo int, not null
);



create table Cliente (
    ID int primary key,
    TipoCliente varchar(20) not null,
    constraint FkClienteID foreign key (ID) references Usuario(ID),
    constraint chk_tipocliente check (TipoCliente in ('Nuevo', 'Frecuente', 'Vip'))
);

create table Empleado (
    ID int primary key,
    Rango varchar(50) not null,
    Anular Bit, 
    modificar Bit,
    ResID int not null,
    Estado varchar(20) not null,
    constraint FkEmpleadoID foreign key (ID) references Usuario(ID),
    constraint chk_rango check (Rango in ('Administrador', 'Encargado', 'Cajero', 'Mesero', 'Administrativo'))
);

create table Restaurante (
    ID int identity(1,1) primary key,
    Nombre varchar(50) not null,
    Direccion varchar(100) not null,
    Telefono varchar(20) not null,
    HoraApertura time not null,
    HoraCierre time not null
);

create table FotoRestaurante (
    RestauranteId int primary key,
    Foto varchar(12),
    constraint FkFotoRestaurante foreign key (RestauranteId) references Restaurante(ID)
);

create table Menu (
    ID int identity(1,1) primary key,
    NombrePlato varchar(50) not null,
    Descripcion varchar(255) not null,
    Precio float,
	Categoria varchar(50) not null,
);
create table MenuRestaurante(
	IdMenu int not null,
	IdRestaurante int not null,
	Primary key(IdMenu,IdRestaurante),
	constraint FkMenu foreign key(IdMenu) references Menu(ID),
	constraint IdRestaurante foreign key(IdRestaurante) references Restaurante(ID)
)
create table FotoMenu (
    MenuId int primary key,
    Foto int,
    constraint FkFotoMenu foreign key (MenuId) references Menu(ID)
);
create table FotoUsuario (
    UserID int primary key,
    FotoName varchar (24),
    constraint FkUserId foreign key (UserID) references Usuario(ID)
);

create table Mesa (
    ID int identity(1,1) primary key,
    NumeroMesa int not null,
    Capacidad int not null,
    Restauranteid int,
    constraint FkMesaRestaurante foreign key (RestauranteId) references Restaurante(ID),
	constraint chkMesaRestaurante unique(NumeroMesa,Restauranteid)
);

create table Reserva (
    ID int identity(1,1) primary key,
    Clienteid int,
    RestauranteId int,
    MesaId int,
    Fecha datetime not null,
    Estado varchar(20) not null,
    constraint FkClienteIdReserva foreign key (ClienteId) references Cliente(ID),
    Constraint FkRestauranteIdReserva foreign key (RestauranteId) references Restaurante(ID),
    Constraint FkMesaIdReserva foreign key (MesaId) references Mesa(ID)
);

create table Reseña (
    ID int identity(1,1) primary key,
    ReservaId int,
    Fecha date not null,
    Comentario varchar(255) not null,
    ClienteId int,
    Puntaje int,
    constraint FkReservaIdReseña foreign key (ReservaId) references Reserva(ID),
    constraint FkClienteIdReseña foreign key (ClienteId) references Cliente(ID)
);

create table Pago (
    ID int identity(1,1) primary key,
    ReservaID int,
    Monto numeric(14,2),
    Fecha date not null,
    MetodoPago varchar(30),
    constraint FkReservaIdPago foreign key (ReservaID) references Reserva(ID)
);

create table Orden (
    ID int identity(1,1) primary key,
    ReservaId int,
    Total numeric(20,2) not null,
    Descuento numeric(20,2),
    constraint FkReservaIdOrden foreign key (ReservaId) references Reserva(ID)
);

create table OrdenDetalle (
    ID int identity(1,1) primary key,
    OrdenId int,
    MenuId int,
    RestauranteId int,
    Cantidad int not null,
    constraint FkOrdenIdOrdenDetalle foreign key (OrdenId) references Orden(ID),
    constraint FkMenuIdOrdenDetalle foreign key (MenuId) references Menu(ID),
    constraint FkRestauranteIdOrdenDetalle foreign key (RestauranteId) references Restaurante(ID)
);

create table Clima
(
   ID int identity (1,1) primary key,
   Fecha time,
   Temperatura varchar(20),
   DescripcionClima varchar(50)
);
INSERT INTO [ObligatorioPG3].[dbo].[Restaurante] (Nombre, Direccion, Telefono, HoraApertura, HoraCierre) Values
('La Costa', 'LA pedrera', '558881001', '09:00:00', '23:00:00'),
('La PArrilla', 'Sierras', '992822822', '09:00:00', '23:00:00'),
('Cantina pedrera', 'Bulevard', '592731978', '09:00:00', '03:00:00');

INSERT INTO Usuario (Nombre, Apellido, Email, Telefono, Contraseña) Values 
('Jose', 'Perez', 'jperez@gmail.com', 12345678, '123'),
('Mario', 'Vera', 'mvera@gmail.com', 987654321, '123'),
('Pedro', 'Pascal', 'ppascal@gmail.com', 12345678, '123');


INSERT INTO Empleado (ID, Rango, ResID, Estado) VALUES
(1, 'Administrador',0, 1),
(2, 'Administrativo',1 , 1),
(3, 'Cajero',2,  1);


